---
# Jekyll HTML Compression Layout
#
# This code is modified from <https://github.com/penibelst/jekyll-compress-html>.
# Licensed under the MIT License.
---

{%- capture _LINE_FEED %}
{% endcapture -%}

{%- if jekyll.environment == 'development' -%}

  {{ content }}

{%- else -%}

  {%- comment -%}Initialization{%- endcomment -%}

  {%- capture _content -%}{{ content }}{%- endcapture -%}


  {%- comment -%}Remove blanklines{%- endcomment -%}

  {%- assign _pre_befores = _content | split: "<pre" -%}
  {%- assign _content = "" -%}
  {%- for _pre_before in _pre_befores -%}
    {%- assign _pres = _pre_before | split: "</pre>" -%}
    {%- assign _pre_after = "" -%}
    {%- if _pres.size != 0 -%}
      {%- assign _lines = _pres.last | split: _LINE_FEED -%}
      {%- capture _pres_after -%}
        {%- for _line in _lines -%}
          {%- assign _trimmed = _line | strip -%}
          {%- if _trimmed != empty or forloop.last -%}
            {%- unless forloop.first -%}{{ _LINE_FEED }}{%- endunless -%}
            {{ _trimmed }}
          {%- endif -%}
        {%- endfor -%}
      {%- endcapture -%}
    {%- endif -%}
    {%- capture _content -%}
      {{ _content }}
      {%- if _pre_before contains "</pre>" -%}<pre{{ _pres.first }}</pre>{%- endif -%}
      {%- unless _pre_before contains "</pre>" and _pres.size == 1 -%}{{ _pres_after }}{%- endunless -%}
    {%- endcapture -%}
  {%- endfor -%}


  {%- comment -%}Output{%- endcomment -%}

  {{ _content }}

{%- endif -%}
